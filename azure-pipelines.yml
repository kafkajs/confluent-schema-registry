# Node.js
# Build a general Node.js project with npm.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript

trigger:
  - master

variables:
  - name: COMPOSE_FILE
    value: docker-compose.yml

jobs:
  - job: lint
    displayName: Lint
    pool:
      vmImage: 'Ubuntu 16.04'
    steps:
      - task: NodeTool@0
        inputs:
          versionSpec: '8.x'
      - bash: yarn install
        displayName: yarn install
      - bash: yarn lint
        displayName: yarn lint

  - job: unit_tests
    displayName: Tests
    dependsOn: lint
    pool:
      vmImage: 'Ubuntu 16.04'
    steps:
      - task: NodeTool@0
        inputs:
          versionSpec: '8.x'
      - bash: yarn install
        displayName: yarn install
      - bash: docker-compose -f ${COMPOSE_FILE} pull
        displayName: docker-compose pull
      - bash: yarn test
        displayName: integration test with dockest
